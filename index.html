<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWH Chatbot Challenge</title>
    <style>
        /* =========================================
           UI/UX DESIGN - CLEAN & PROFESSIONAL
           ========================================= */
        :root {
            --primary: #0d47a1;       /* AWH Blue */
            --bg-color: #f4f7f6;      
            --chat-bg: #ffffff;
            --text-main: #333333;
            --text-light: #666666;
            --bot-bubble: #e3f2fd;
            --user-bubble: #0d47a1;
            --user-text: #ffffff;
        }

        [data-theme="dark"] {
            --chat-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-light: #aaaaaa;
            --bot-bubble: #2c2c2c;
            --user-bubble: #3f51b5;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            background-image: radial-gradient(#dee2e6 1px, transparent 1px);
            background-size: 20px 20px;
            height: 100vh;
            overflow: hidden;
        }

        /* LAUNCHER BUTTON */
        .chat-launcher {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background-color: var(--primary); color: white; border-radius: 50%;
            border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 2000; display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .chat-launcher:hover { transform: scale(1.1); background-color: #002171; }

        /* CHAT WIDGET */
        .chat-wrapper {
            position: fixed; bottom: 100px; right: 30px; width: 380px; height: 600px;
            max-height: 80vh; background-color: var(--chat-bg); border-radius: 20px;
            box-shadow: 0 5px 40px rgba(0,0,0,0.2); display: none; flex-direction: column;
            overflow: hidden; z-index: 1999; border: 1px solid rgba(0,0,0,0.1);
            animation: popUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes popUp { from { opacity: 0; transform: scale(0.8) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        @media (max-width: 480px) {
            .chat-wrapper { bottom: 0; right: 0; width: 100%; height: 100%; max-height: 100vh; border-radius: 0; }
            .chat-launcher { bottom: 20px; right: 20px; }
        }

        /* HEADER */
        .header { background-color: var(--primary); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header-title { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 1.1rem; }
        .icon-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; padding: 0; opacity: 0.8; transition: opacity 0.2s; }
        .icon-btn:hover { opacity: 1; }

        /* MESSAGES */
        .messages-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 0.95rem; line-height: 1.5; word-wrap: break-word; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bot { background-color: var(--bot-bubble); color: var(--text-main); align-self: flex-start; border-bottom-left-radius: 4px; }
        .user { background-color: var(--user-bubble); color: var(--user-text); align-self: flex-end; border-bottom-right-radius: 4px; }
        
        .message strong { font-weight: 700; }
        .message ul { margin: 5px 0 5px 20px; padding: 0; }
        .message a { color: var(--primary); text-decoration: none; font-weight: 600; border-bottom: 1px dotted var(--primary); }
        [data-theme="dark"] .message a { color: #64b5f6; border-color: #64b5f6; }
        
        /* === CAROUSEL (SLIDESHOW) STYLES === */
        .carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            width: 100%;
        }
        .carousel::-webkit-scrollbar { height: 6px; }
        .carousel::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .carousel::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
        
        .carousel img {
            width: 200px; 
            height: 140px;
            object-fit: cover;
            border-radius: 12px;
            flex-shrink: 0; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .carousel img:hover { transform: scale(1.05); }


        /* INPUT AREA */
        .quick-actions { padding: 10px 15px; display: flex; gap: 8px; overflow-x: auto; background-color: var(--chat-bg); border-top: 1px solid rgba(0,0,0,0.05); scrollbar-width: none; }
        .quick-actions::-webkit-scrollbar { display: none; }
        .pill { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
        .pill:hover { background-color: var(--primary); color: white; }
        [data-theme="dark"] .pill { border-color: #64b5f6; color: #64b5f6; }

        .input-box { padding: 15px; background-color: var(--chat-bg); display: flex; gap: 10px; align-items: center; }
        input { flex: 1; padding: 12px 16px; border: 1px solid #ddd; border-radius: 25px; outline: none; background-color: var(--bg-color); color: var(--text-main); }
        input:focus { border-color: var(--primary); }
        .send-btn { background-color: var(--primary); color: white; border: none; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; }

        /* FOOTER */
        .chat-footer { text-align: center; font-size: 0.75rem; color: var(--text-light); padding: 5px; background: var(--chat-bg); opacity: 0.7; }

        .typing-indicator { display: none; padding: 10px 15px; background-color: var(--bot-bubble); border-radius: 18px; align-self: flex-start; margin-left: 20px; margin-bottom: 10px; width: fit-content; }
        .dots { display: flex; gap: 4px; }
        .dot { width: 6px; height: 6px; background-color: #888; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body>

<button class="chat-launcher" onclick="toggleChat()" id="launcherBtn">
    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
</button>

<div class="chat-wrapper" id="chatWindow">
    <div class="header">
        <div class="header-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 0 6-1 9-1 3 0 6 0 9 1v-5"/></svg>
            AWH Assistant
        </div>
        <div>
            <button class="icon-btn" onclick="toggleTheme()" title="Dark Mode">üåô</button>
            <button class="icon-btn" onclick="toggleChat()" title="Close Chat">‚úï</button>
        </div>
    </div>

    <div class="messages-area" id="chatBox">
        <div class="message bot">
            Hello! üëã Welcome to AWH Engineering College.<br>
            I can help you with:<br>
            ‚Ä¢ Departments<br>
            ‚Ä¢ Courses<br>
            ‚Ä¢ Events<br>
            ‚Ä¢ Location<br><br>
            Shoot your queries! ‚òª
        </div>
    </div>

    <div class="typing-indicator" id="loader">
        <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
    </div>

    <div class="quick-actions">
        <button class="pill" onclick="sendQuick('Departments')">Departments</button>
        <button class="pill" onclick="sendQuick('Events')">Events</button>
        <button class="pill" onclick="sendQuick('Placements')">Placements</button>
        <button class="pill" onclick="sendQuick('Gallery')">üì∏ Gallery</button>
    </div>

    <div class="input-box">
        <input type="text" id="userInput" placeholder="Type a message..." onkeypress="handleEnter(event)">
        <button class="send-btn" onclick="sendMessage()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
        </button>
    </div>

    <div class="chat-footer">Powered by Gemini AI</div>
</div>

<script>
    // ===============================================
    // YOUR API KEY
    // ===============================================
    const API_KEY = "AIzaSyDKbOtWve9E0G-fws_B-jg5N7I-C5u0CDI"; 
    // ===============================================

    const chatWindow = document.getElementById('chatWindow');
    const launcherBtn = document.getElementById('launcherBtn');
    const chatBox = document.getElementById('chatBox');
    const userInput = document.getElementById('userInput');
    const loader = document.getElementById('loader');

    // --- INTERACTIVE IDLE LOGIC ---
    let idleTimer;
    let suggestionContext = null; // Memory for what the bot asked

    function resetIdleTimer() {
        if (chatWindow.style.display === 'none') return;
        
        clearTimeout(idleTimer);
        // Set timer for 10 seconds
        idleTimer = setTimeout(() => {
            const suggestions = [
                { text: "Would you like to see our **Placements**? üíº", key: "placements" },
                { text: "Curious about **Admissions**? üéì", key: "admissions" },
                { text: "Need our **Contact Info**? üìû", key: "contact" },
                { text: "Want to see some **Photos**? üì∏", key: "gallery" }
            ];
            
            // Pick a random topic
            const selected = suggestions[Math.floor(Math.random() * suggestions.length)];
            
            // Remember the topic!
            suggestionContext = selected.key;
            
            addMessage(parseMarkdown(`<i>(Bot)</i> Hey! ` + selected.text), 'bot');
        }, 10000); 
    }

    // 1. TOGGLE CHAT
    function toggleChat() {
        if (chatWindow.style.display === 'none' || chatWindow.style.display === '') {
            chatWindow.style.display = 'flex';
            launcherBtn.style.transform = 'scale(0)';
            setTimeout(() => launcherBtn.style.display = 'none', 200);
            setTimeout(() => userInput.focus(), 300);
            resetIdleTimer(); 
        } else {
            chatWindow.style.display = 'none';
            launcherBtn.style.display = 'flex';
            setTimeout(() => launcherBtn.style.transform = 'scale(1)', 10);
            clearTimeout(idleTimer); 
            suggestionContext = null; // Reset memory on close
        }
    }

    // 2. HARDCODED KNOWLEDGE
    const collegeData = {
        name: "AWH Engineering College",
        departments: `<strong>Our Departments:</strong><ul><li>Computer Science (CSE)</li><li>AI & Data Science (AI&DS)</li><li>Electronics (ECE)</li><li>Electrical (EEE)</li><li>Mechanical (ME)</li><li>Civil (CE)</li><li>MCA</li></ul>`,
        courses: `<strong>Academic Programs:</strong><br>‚Ä¢ B.Tech (KTU Affiliated)<br>‚Ä¢ M.Tech (Structural, CSE, VLSI)<br>‚Ä¢ MCA`,
        
        // EVENTS
        events: `<strong>üéâ Saaya Cultural Fest:</strong><br>üìÖ February 5 & 6<br>A celebration of arts & music!<br><br><strong>ü§ñ ATHMA Technical Fest:</strong><br>üìÖ February 7<br>The flagship tech fest with hackathons & robotics.`,
        
        // LOCATION
        location: `<strong>Find Us Here:</strong><br>üìç Kuttikkattoor, Kozhikode, Kerala.<br><a href="https://www.google.com/maps/search/?api=1&query=AWH+Engineering+College" target="_blank">View on Google Maps üó∫Ô∏è</a>`,
        
        // CONTACT
        contact: `<strong>Contact Us:</strong><br>üìû <a href="tel:04952352552">0495-2352552</a><br>üìß <a href="mailto:info@awhengg.org">info@awhengg.org</a>`,
        
        admissions: `<strong>Admissions:</strong><br>We offer B.Tech admission based on KEAM rank and Management Quota. <br>Please visit the college office for seat availability and fee structure.`,
        
        placements: `<strong>Placements:</strong><br>Our Placement Cell is very active! Top recruiters include Infosys, TCS, and UST Global.`,
        
        facilities: `<strong>Campus Facilities:</strong><br>‚Ä¢ üöç College Bus Service (All routes)<br>‚Ä¢ üè† Hostels (Boys & Girls)<br>‚Ä¢ üìö Central Library<br>‚Ä¢ üì∂ Wi-Fi Campus`,
        
        principal: `Our Principal leads the academic vision of AWH Engineering College with a focus on excellence and innovation.`
    };

    const jokes = [
        "Why do Java developers wear glasses? Because they don't C#! üòÇ",
        "A SQL query walks into a bar, walks up to two tables and asks... 'Can I join you?' üíæ",
        "How many programmers does it take to change a light bulb? None. It's a hardware problem. üí°",
        "There are 10 types of people in the world: Those who understand binary, and those who don't. 0Ô∏è‚É£1Ô∏è‚É£",
        "My code works, I have no idea why. My code doesn't work, I have no idea why. ü§∑‚Äç‚ôÇÔ∏è"
    ];

    let isDark = false;
    function toggleTheme() {
        isDark = !isDark;
        document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
    }

    function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }
    function sendQuick(text) { userInput.value = text; sendMessage(); }

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        addMessage(text, 'user');
        userInput.value = '';
        resetIdleTimer(); 

        const lower = text.toLowerCase();
        let reply = null;

        // --- CONTEXT AWARENESS (DID YOU SAY YES?) ---
        if (suggestionContext && (lower === 'yes' || lower === 'y' || lower === 'sure' || lower === 'yeah' || lower === 'ok')) {
            // Check what the bot was thinking about
            if (suggestionContext === 'gallery') {
                reply = getGalleryHTML();
            } else if (collegeData[suggestionContext]) {
                reply = collegeData[suggestionContext];
            }
            suggestionContext = null; // Clear memory after answering
        } 
        
        // --- CONTEXT AWARENESS (DID YOU SAY NO?) ---
        else if (suggestionContext && (lower === 'no' || lower === 'n' || lower === 'nope')) {
            reply = "Okay! Let me know if you need anything else. üòä";
            suggestionContext = null; // Clear memory
        }

        // --- STANDARD LOGIC (If no context or user ignored question) ---
        else {
            // If user ignored the question, clear memory so it doesn't get stuck
            suggestionContext = null;

            if (lower.includes('department') || lower.includes('branch')) reply = collegeData.departments;
            else if (lower.includes('course') || lower.includes('b.tech') || lower.includes('m.tech')) reply = collegeData.courses;
            else if (lower.includes('event') || lower.includes('saaya') || lower.includes('athma')) reply = collegeData.events;
            else if (lower.includes('location') || lower.includes('where') || lower.includes('address')) reply = collegeData.location;
            else if (lower.includes('contact') || lower.includes('phone') || lower.includes('email')) reply = collegeData.contact;
            else if (lower.includes('admission') || lower.includes('fee') || lower.includes('seat') || lower.includes('join')) reply = collegeData.admissions;
            else if (lower.includes('placement') || lower.includes('job') || lower.includes('recruit')) reply = collegeData.placements;
            else if (lower.includes('hostel') || lower.includes('bus') || lower.includes('facility') || lower.includes('library') || lower.includes('transport')) reply = collegeData.facilities;
            else if (lower.includes('principal')) reply = collegeData.principal;

            // Gallery Trigger
            else if (lower.includes('photo') || lower.includes('image') || lower.includes('pic') || lower.includes('gallery')) {
                reply = getGalleryHTML();
            }

            // Greetings
            else if (lower.includes('hi') || lower.includes('hello') || lower.includes('hey')) reply = "Hello! üëã How can I assist you today?";
            else if (lower.includes('how are you') || lower.includes('how r u')) reply = "I'm doing great, thanks for asking! ü§ñ";
            else if (lower.includes('good morning') || lower.includes('goodmorning')) reply = "Good morning! ‚òÄÔ∏è";
            else if (lower.includes('good afternoon') || lower.includes('goodafternoon')) reply = "Good afternoon! üå§Ô∏è";
            else if (lower.includes('good evening') || lower.includes('goodevening')) reply = "Good evening! üåÜ";
            else if (lower.includes('good night') || lower.includes('goodnight') || lower.includes('gn')) reply = "Good night! üåô Sleep well.";
            else if (lower.includes('thank') || lower.includes('thx')) reply = "You're welcome! üòä";
            else if (lower.includes('bye')) reply = "Goodbye! Have a nice day! üëã";
            else if (lower.includes('help') || lower.includes('menu')) reply = "Try asking about: <strong>Courses, Events, Hostels</strong>, or tap <strong>üì∏ Gallery</strong>!";
        }

        if (reply) {
            showLoader(true);
            setTimeout(() => { showLoader(false); addMessage(reply, 'bot'); }, 600);
        } else {
            showLoader(true);
            try {
                const aiReply = await fetchGemini(text);
                showLoader(false);
                addMessage(parseMarkdown(aiReply), 'bot');
            } catch (err) {
                showLoader(false);
                if (lower.includes('joke')) {
                    const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];
                    addMessage(randomJoke, 'bot');
                } else {
                    addMessage("I'm currently in 'Offline Mode'. <br>Please ask me about <strong>Departments</strong>, <strong>Placements</strong>, or <strong>Events</strong>!", 'bot');
                }
            }
        }
    }

    // Helper to generate Gallery HTML
    function getGalleryHTML() {
        return `
            <strong>Campus Gallery üì∏</strong><br>(Scroll to see more)<br>
            <div class="carousel">
                <img src="clg1.jpeg" onclick="window.open(this.src)" alt="College 1">
                <img src="clg2.jpeg" onclick="window.open(this.src)" alt="College 2">
                <img src="clg3.jpeg" onclick="window.open(this.src)" alt="College 3">
                <img src="clg4.jpeg" onclick="window.open(this.src)" alt="College 4">
                <img src="clg5.jpeg" onclick="window.open(this.src)" alt="College 5">
            </div>
        `;
    }

    function addMessage(html, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        div.innerHTML = html;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showLoader(show) {
        loader.style.display = show ? 'block' : 'none';
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function parseMarkdown(text) {
        let parsed = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        parsed = parsed.replace(/^\* /gm, '‚Ä¢ ');
        return parsed;
    }

    async function fetchGemini(prompt) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        const promptContext = `You are a helpful student volunteer at AWH Engineering College. 
        User: "${prompt}". 
        Guidelines:
        1. Keep answers polite, short (max 2 sentences), and use emojis.
        2. If the user asks something completely unrelated to college life (like politics, violence, or random topics), politely say you can only answer college-related queries.`;

        const payload = {
            contents: [{ parts: [{ text: promptContext }] }]
        };

        const res = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
        
        if (!res.ok) throw new Error("API Error");
        const data = await res.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I didn't understand.";
    }
</script>

</body>
</html>
