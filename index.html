<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWH Campus Assistant</title>
    <style>
        /* =========================================
           THEME & VARIABLES 
           ========================================= */
        :root {
            --primary: #0d47a1;       /* AWH Blue */
            --bg-color: #f4f7f6;      /* Webpage Background */
            --chat-bg: #ffffff;
            --text-main: #333333;
            --bot-bubble: #e3f2fd;
            --user-bubble: #0d47a1;
            --user-text: #ffffff;
        }

        [data-theme="dark"] {
            --chat-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --bot-bubble: #2c2c2c;
            --user-bubble: #3f51b5;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            background-image: radial-gradient(#dee2e6 1px, transparent 1px);
            background-size: 20px 20px;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll when chat is open on mobile */
        }

        /* =========================================
           LAUNCHER BUTTON (Floating Icon)
           ========================================= */
        .chat-launcher {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, background-color 0.2s;
        }

        .chat-launcher:hover {
            transform: scale(1.1);
            background-color: #002171;
        }

        /* =========================================
           CHAT WIDGET (Initially Hidden)
           ========================================= */
        .chat-wrapper {
            position: fixed;
            bottom: 100px; /* Above the launcher */
            right: 30px;
            width: 380px;
            height: 600px;
            max-height: 80vh; /* Don't be too tall on small screens */
            background-color: var(--chat-bg);
            border-radius: 20px;
            box-shadow: 0 5px 40px rgba(0,0,0,0.2);
            display: none; /* HIDDEN BY DEFAULT */
            flex-direction: column;
            overflow: hidden;
            z-index: 1999;
            border: 1px solid rgba(0,0,0,0.1);
            animation: popUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        @keyframes popUp {
            from { opacity: 0; transform: scale(0.8) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* RESPONSIVE: Full screen on mobile */
        @media (max-width: 480px) {
            .chat-wrapper {
                bottom: 0;
                right: 0;
                width: 100%;
                height: 100%;
                max-height: 100vh;
                border-radius: 0;
            }
            .chat-launcher {
                bottom: 20px;
                right: 20px;
            }
        }

        /* =========================================
           HEADER & CONTROLS
           ========================================= */
        .header {
            background-color: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        .icon-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .icon-btn:hover { opacity: 1; }

        /* =========================================
           CHAT AREA
           ========================================= */
        .messages-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot {
            background-color: var(--bot-bubble);
            color: var(--text-main);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .user {
            background-color: var(--user-bubble);
            color: var(--user-text);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        /* Formatting Helpers */
        .message strong { font-weight: 700; }
        .message ul { margin: 5px 0 5px 20px; padding: 0; }
        .message li { margin-bottom: 4px; }

        /* =========================================
           INPUT AREA
           ========================================= */
        .quick-actions {
            padding: 10px 15px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            background-color: var(--chat-bg);
            border-top: 1px solid rgba(0,0,0,0.05);
            scrollbar-width: none; 
        }
        .quick-actions::-webkit-scrollbar { display: none; }

        .pill {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .pill:hover { background-color: var(--primary); color: white; }

        [data-theme="dark"] .pill { border-color: #64b5f6; color: #64b5f6; }
        [data-theme="dark"] .pill:hover { background-color: #64b5f6; color: #121212; }

        .input-box {
            padding: 15px;
            background-color: var(--chat-bg);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            background-color: var(--bg-color);
            color: var(--text-main);
        }

        input:focus { border-color: var(--primary); }

        .send-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .typing-indicator {
            display: none;
            padding: 10px 15px;
            background-color: var(--bot-bubble);
            border-radius: 18px;
            align-self: flex-start;
            margin-left: 20px;
            margin-bottom: 10px;
            width: fit-content;
        }

        .dots { display: flex; gap: 4px; }
        .dot {
            width: 6px; height: 6px; background-color: #888; border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    </style>
</head>
<body>

<button class="chat-launcher" onclick="toggleChat()" id="launcherBtn">
    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
</button>

<div class="chat-wrapper" id="chatWindow">
    <div class="header">
        <div class="header-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 0 6-1 9-1 3 0 6 0 9 1v-5"/></svg>
            AWH Assistant
        </div>
        <div class="header-controls">
            <button class="icon-btn" onclick="toggleTheme()" title="Dark Mode">üåô</button>
            <button class="icon-btn" onclick="toggleChat()" title="Close Chat">‚úï</button>
        </div>
    </div>

    <div class="messages-area" id="chatBox">
        <div class="message bot">
            Hello! üëã I'm your AWH Engineering College virtual assistant.<br><br>
            <strong>I can help you with:</strong><br>
            ‚Ä¢ Departments & Courses<br>
            ‚Ä¢ Saaya & ATHMA Fests<br>
            ‚Ä¢ Campus Location<br><br>
            Ask me anything! üòä
        </div>
    </div>

    <div class="typing-indicator" id="loader">
        <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
    </div>

    <div class="quick-actions">
        <button class="pill" onclick="sendQuick('Departments')">Departments</button>
        <button class="pill" onclick="sendQuick('Courses')">Courses</button>
        <button class="pill" onclick="sendQuick('Events')">Events</button>
        <button class="pill" onclick="sendQuick('Location')">Location</button>
    </div>

    <div class="input-box">
        <input type="text" id="userInput" placeholder="Type a message..." onkeypress="handleEnter(event)">
        <button class="send-btn" onclick="sendMessage()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
        </button>
    </div>
</div>

<script>
    // ===============================================
    // YOUR API KEY
    // ===============================================
    const API_KEY = "AIzaSyDKbOtWve9E0G-fws_B-jg5N7I-C5u0CDI"; 
    // ===============================================

    const chatWindow = document.getElementById('chatWindow');
    const launcherBtn = document.getElementById('launcherBtn');
    const chatBox = document.getElementById('chatBox');
    const userInput = document.getElementById('userInput');
    const loader = document.getElementById('loader');

    // 1. TOGGLE CHAT VISIBILITY
    function toggleChat() {
        if (chatWindow.style.display === 'none' || chatWindow.style.display === '') {
            chatWindow.style.display = 'flex';
            launcherBtn.style.transform = 'scale(0)'; // Shrink button
            setTimeout(() => launcherBtn.style.display = 'none', 200);
        } else {
            chatWindow.style.display = 'none';
            launcherBtn.style.display = 'flex';
            setTimeout(() => launcherBtn.style.transform = 'scale(1)', 10);
        }
    }

    // 2. HARDCODED DATA
    const collegeData = {
        name: "AWH Engineering College",
        departments: `<strong>Our Departments:</strong><ul><li>Computer Science (CSE)</li><li>AI & Data Science (AI&DS)</li><li>Electronics (ECE)</li><li>Electrical (EEE)</li><li>Mechanical (ME)</li><li>Civil (CE)</li><li>MCA</li></ul>`,
        courses: `<strong>Courses Offered:</strong><br>We offer B.Tech programs affiliated with KTU in all major engineering branches.<br><br><strong>Postgraduate:</strong><br>‚Ä¢ MCA<br>‚Ä¢ M.Tech in Structural Eng, CSE, and VLSI Design.`,
        events: `<strong>üéâ Saaya (Cultural Fest):</strong><br>Our massive annual arts festival! It's a kaleidoscope of music, dance, and fine arts where students showcase their creative side.<br><br><strong>ü§ñ ATHMA (Technical Fest):</strong><br>The flagship tech fest! Features the 'ATHMATHON' hackathon, robotics wars, and coding challenges.`,
        location: `<strong>Find Us Here:</strong><br>üìç Kuttikkattoor, Kozhikode, Kerala - 673008.<br>(We are about 12km from the main Kozhikode city).`,
        contact: `üìû 0495-2352552<br>üìß info@awhengg.org`
    };

    // 3. THEME LOGIC
    let isDark = false;
    function toggleTheme() {
        isDark = !isDark;
        document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
        const themeBtn = document.querySelector('.icon-btn[title="Dark Mode"]');
        themeBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    }

    // 4. CHAT LOGIC
    function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }
    function sendQuick(text) { userInput.value = text; sendMessage(); }

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        addMessage(text, 'user');
        userInput.value = '';

        const lower = text.toLowerCase();
        let reply = null;

        if (lower.includes('department') || lower.includes('branch')) reply = collegeData.departments;
        else if (lower.includes('course') || lower.includes('b.tech') || lower.includes('m.tech')) reply = collegeData.courses;
        else if (lower.includes('event') || lower.includes('saaya') || lower.includes('athma')) reply = collegeData.events;
        else if (lower.includes('location') || lower.includes('where')) reply = collegeData.location;
        else if (lower.includes('contact') || lower.includes('phone') || lower.includes('email')) reply = collegeData.contact;
        
        // SAFE GREETINGS (Offline supported)
        else if (lower.includes('hi') || lower.includes('hello') || lower.includes('hey')) {
            reply = "Hello! üëã Welcome to AWH Engineering College. How can I assist you today?";
        }
        else if (lower.includes('thank')) {
            reply = "You're welcome! üòä Let me know if you need anything else.";
        }
        else if (lower.includes('bye')) {
            reply = "Goodbye! Have a great day! üëã";
        }

        if (reply) {
            showLoader(true);
            setTimeout(() => { showLoader(false); addMessage(reply, 'bot'); }, 600);
        } else {
            showLoader(true);
            try {
                const aiReply = await fetchGemini(text);
                showLoader(false);
                addMessage(parseMarkdown(aiReply), 'bot');
            } catch (err) {
                showLoader(false);
                // OFFLINE FALLBACK
                if (lower.includes('joke')) {
                    addMessage("Why did the developer go broke? Because he used up all his cache! üòÇ", 'bot');
                } else {
                    addMessage("I'm currently in 'Offline Mode' due to network restrictions. <br>Please ask me about <strong>Courses</strong>, <strong>Events</strong>, or <strong>Location</strong>!", 'bot');
                }
            }
        }
    }

    function addMessage(html, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        div.innerHTML = html;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showLoader(show) {
        loader.style.display = show ? 'block' : 'none';
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function parseMarkdown(text) {
        let parsed = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        parsed = parsed.replace(/^\* /gm, '‚Ä¢ ');
        return parsed;
    }

    async function fetchGemini(prompt) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        const payload = {
            contents: [{ parts: [{ text: `You are a helpful student volunteer at AWH Engineering College. User: "${prompt}". Keep answers polite, short (max 2 sentences), and use emojis.` }] }]
        };

        const res = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
        
        if (!res.ok) throw new Error("API Error");
        const data = await res.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I didn't understand.";
    }
</script>

</body>
</html>
